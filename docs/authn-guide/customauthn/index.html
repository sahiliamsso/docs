
<!DOCTYPE html>
<html class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documenation for Gluu Server">
      
      
      
      
        <link rel="shortcut icon" href="../../favicon.ico">
      
      <meta name="generator" content="mkdocs+mkdocs-material#1.0.3">
    
    
      
        <title>Custom Authentication - Gluu Docs</title>
      
    
    
      <script src="../../assets/javascripts/modernizr-facb31f4a3.js"></script>
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application-f3ab63f78a.css">
      
      
    
    
  </head>
  
  
  
  
    <body>
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
	 <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Gluu Docs" class=" md-logo  md-header-nav__button">
          
            <img src="../../gluu.jpg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Administration Guide
                </span>
              
                <span class="md-header-nav__parent">
                  User Authentication Guide
                </span>
              
            
            Custom Authentication
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <div class="md-search__overlay"></div>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false">
      <label class="md-icon md-search__icon" for="search"></label>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result"></div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            
              


  


  <a href="https://github.com/GluuFederation/docs-3" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

            
          </div>
      </div>
    </div>
  </nav>

<nav class="md-secondary-header-nav md-grid" style="
    height: 45px;
    background: transparent;
	
">
<div class="md-flex-secondary" style="
    display: table;
    padding: 10px;
">
<select id="versions" onchange="window.location.href=this.value;" style="
    position: relative;
    display: block;
    /*min-width: 100%;*/
    width: 120%; 
    height: 25px;
    padding: 5px 10px 5px 5px;
    color: #555555;
    border: none;
    background: transparent;
    outline: none;
    -webkit-appearance: none;
    z-index: 99;
    cursor: pointer;
    font-size: 10px;
    margin-bottom: 10px;
    border: 1px solid black;
">
  <option value="/docs-3">Latest</option>
  <option value="/docs">2.4.4.2</option>
    </select> 

 </div>
   </nav>
</header>
    
    <div class="md-container">
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <i class=" md-logo  md-nav__button">
      
        <img src="../../gluu.jpg">
      
    </i>
    Gluu Docs
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/GluuFederation/docs-3" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  <li class="md-nav__item">
    
      <a href="../.." title="Home" class="md-nav__link">
        Home
      </a>
    
  </li>

    
      
      
  <li class="md-nav__item">
    
      <a href="../../operation/intro/" title="Whats new in 3.0" class="md-nav__link">
        Whats new in 3.0
      </a>
    
  </li>

    
      
      
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Installation Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-3">
        Installation Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../../installation-guide/" title="Preparing VM" class="md-nav__link">
        Preparing VM
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../installation-guide/install/" title="Install Gluu Server" class="md-nav__link">
        Install Gluu Server
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../installation-guide/setup_py/" title="Setup Script Options" class="md-nav__link">
        Setup Script Options
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-4" type="checkbox" id="nav-3-4">
    
    <label class="md-nav__link" for="nav-3-4">
      Upgrade/Patch Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-3-4">
        Upgrade/Patch Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../../upgrade/" title="Upgrade Gluu Server" class="md-nav__link">
        Upgrade Gluu Server
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../upgrade/update-war/" title="Updating a War File" class="md-nav__link">
        Updating a War File
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Administration Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-4">
        Administration Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../../admin-guide/oxtrust-ui/" title="oxTrust admin UI" class="md-nav__link">
        oxTrust admin UI
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../admin-guide/custom-script/" title="Interception Scripts" class="md-nav__link">
        Interception Scripts
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../admin-guide/logs/" title="Log Management" class="md-nav__link">
        Log Management
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../admin-guide/user-group/" title="User Management" class="md-nav__link">
        User Management
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../admin-guide/session/" title="Session Timeout" class="md-nav__link">
        Session Timeout
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../admin-guide/auth-management/" title="Authentication Management" class="md-nav__link">
        Authentication Management
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-7" type="checkbox" id="nav-4-7" checked>
    
    <label class="md-nav__link" for="nav-4-7">
      User Authentication Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-4-7">
        User Authentication Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../../admin-guide/user-authentications/" title="User Authentication Introduction" class="md-nav__link">
        User Authentication Introduction
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../passport/" title="Social Authentication" class="md-nav__link">
        Social Authentication
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../supergluu/" title="Super Gluu" class="md-nav__link">
        Super Gluu
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../U2F/" title="FIDO U2F" class="md-nav__link">
        FIDO U2F
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../duo/" title="Duo Security" class="md-nav__link">
        Duo Security
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../cert-auth/" title="Certificate Authentication" class="md-nav__link">
        Certificate Authentication
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../google/" title="Google" class="md-nav__link">
        Google
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../otp/" title="HOTP/TOTP" class="md-nav__link">
        HOTP/TOTP
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Custom Authentication
      </label>
    
    <a href="./" title="Custom Authentication" class="md-nav__link md-nav__link--active">
      Custom Authentication
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#twilio-sms-authentication-otp-using-custom-script" title="Twilio SMS Authentication - OTP using custom script" class="md-nav__link">
    Twilio SMS Authentication - OTP using custom script
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#writing-a-custom-authentication-script" title="Writing a Custom Authentication Script" class="md-nav__link">
    Writing a Custom Authentication Script
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-script-location" title="Custom Script Location" class="md-nav__link">
    Custom Script Location
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#suggested-development-environment" title="Suggested Development Environment" class="md-nav__link">
    Suggested Development Environment
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samples-and-documentation" title="Samples and Documentation" class="md-nav__link">
    Samples and Documentation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implement-methods-using-twilio-sms" title="Implement methods - Using Twilio SMS" class="md-nav__link">
    Implement methods - Using Twilio SMS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#methods" title="Methods" class="md-nav__link">
    Methods
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#saving-the-value-in-ldap-and-passing-values-between-two-steps" title="Saving the value in LDAP and Passing values between two steps" class="md-nav__link">
    Saving the value in LDAP and Passing values between two steps
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#saving-values" title="Saving Values:" class="md-nav__link">
    Saving Values:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retriving-and-passing-values-between-the-authentication-steps" title="Retriving and passing values between the authentication steps:" class="md-nav__link">
    Retriving and passing values between the authentication steps:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-properties" title="Custom Properties" class="md-nav__link">
    Custom Properties
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#returning-a-message-to-the-user" title="Returning a message to the user" class="md-nav__link">
    Returning a message to the user
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-libraries" title="Adding Libraries" class="md-nav__link">
    Adding Libraries
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing" title="Testing" class="md-nav__link">
    Testing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reverting-authentication-method" title="Reverting Authentication Method" class="md-nav__link">
    Reverting Authentication Method
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../admin-guide/saml/" title="SAML" class="md-nav__link">
        SAML
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../admin-guide/openid-connect/" title="OpenID Connect" class="md-nav__link">
        OpenID Connect
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../admin-guide/uma/" title="UMA" class="md-nav__link">
        UMA
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../admin-guide/attribute/" title="Attribute Management" class="md-nav__link">
        Attribute Management
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../admin-guide/scim-uma/" title="SCIM protected by UMA" class="md-nav__link">
        SCIM protected by UMA
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../admin-guide/certificate/" title="Certificate Management" class="md-nav__link">
        Certificate Management
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../admin-guide/faq/" title="FAQ & Troubleshooting" class="md-nav__link">
        FAQ & Troubleshooting
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Integration Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-5">
        Integration Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/saml-sp/" title="Shibboleth SP" class="md-nav__link">
        Shibboleth SP
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/openidc-rp/" title="Mod_auth_OpenID" class="md-nav__link">
        Mod_auth_OpenID
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/oauth2/" title="OXD OAuth2" class="md-nav__link">
        OXD OAuth2
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/google/" title="Google SSO" class="md-nav__link">
        Google SSO
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/office/" title="Office 365" class="md-nav__link">
        Office 365
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/salesforce/" title="Salesforce" class="md-nav__link">
        Salesforce
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/dropbox/" title="Dropbox" class="md-nav__link">
        Dropbox
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Reference
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-6">
        Reference
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-1" type="checkbox" id="nav-6-1">
    
    <label class="md-nav__link" for="nav-6-1">
      Gluu API Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-6-1">
        Gluu API Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../../api-guide/api/" title="Custom ID Generation" class="md-nav__link">
        Custom ID Generation
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../api-guide/openid-connect-api/" title="OpenID Connect API" class="md-nav__link">
        OpenID Connect API
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../api-guide/scim-api/" title="SCIM API Configuration" class="md-nav__link">
        SCIM API Configuration
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../api-guide/uma-api/" title="UMA API" class="md-nav__link">
        UMA API
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-2" type="checkbox" id="nav-6-2">
    
    <label class="md-nav__link" for="nav-6-2">
      JSON Properties
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-6-2">
        JSON Properties
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../../reference/JSON-oxtrust-prop/" title="OxTrust JSON Properties" class="md-nav__link">
        OxTrust JSON Properties
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../reference/JSON-oxauth-prop/" title="OxAuth JSON Properties" class="md-nav__link">
        OxAuth JSON Properties
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Operation Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-7">
        Operation Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../../operation/backup/" title="Backup Gluu Server CE" class="md-nav__link">
        Backup Gluu Server CE
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../operation/find-gluu-version/" title="Know your Gluu Version" class="md-nav__link">
        Know your Gluu Version
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../operation/ports/" title="Ports used in Gluu" class="md-nav__link">
        Ports used in Gluu
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../operation/logout/" title="Logout from Gluu Server" class="md-nav__link">
        Logout from Gluu Server
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#twilio-sms-authentication-otp-using-custom-script" title="Twilio SMS Authentication - OTP using custom script" class="md-nav__link">
    Twilio SMS Authentication - OTP using custom script
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#writing-a-custom-authentication-script" title="Writing a Custom Authentication Script" class="md-nav__link">
    Writing a Custom Authentication Script
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-script-location" title="Custom Script Location" class="md-nav__link">
    Custom Script Location
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#suggested-development-environment" title="Suggested Development Environment" class="md-nav__link">
    Suggested Development Environment
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samples-and-documentation" title="Samples and Documentation" class="md-nav__link">
    Samples and Documentation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implement-methods-using-twilio-sms" title="Implement methods - Using Twilio SMS" class="md-nav__link">
    Implement methods - Using Twilio SMS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#methods" title="Methods" class="md-nav__link">
    Methods
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#saving-the-value-in-ldap-and-passing-values-between-two-steps" title="Saving the value in LDAP and Passing values between two steps" class="md-nav__link">
    Saving the value in LDAP and Passing values between two steps
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#saving-values" title="Saving Values:" class="md-nav__link">
    Saving Values:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retriving-and-passing-values-between-the-authentication-steps" title="Retriving and passing values between the authentication steps:" class="md-nav__link">
    Retriving and passing values between the authentication steps:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-properties" title="Custom Properties" class="md-nav__link">
    Custom Properties
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#returning-a-message-to-the-user" title="Returning a message to the user" class="md-nav__link">
    Returning a message to the user
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-libraries" title="Adding Libraries" class="md-nav__link">
    Adding Libraries
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing" title="Testing" class="md-nav__link">
    Testing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reverting-authentication-method" title="Reverting Authentication Method" class="md-nav__link">
    Reverting Authentication Method
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
               
                 <a href="https://github.com/GluuFederation/docs-3/blob/master/source/authn-guide\customauthn.md" title="Edit this page" class="md-icon md-content__edit">edit</a>
               
              
                
                <h1 id="custom-script-authenticaion">Custom Script Authenticaion:<a class="headerlink" href="#custom-script-authenticaion" title="Permanent link">#</a></h1>
<p>Gluu offers the feasibility to use tailored scripts with 
3rd party authentication providers like Twilio SMS,RESTCOMM,
Plivo,SMSGlobal,INFOBIP, etc. Where the script developed internally 
using 3rd party API's to get a text or call to authenticate you 
through to the system. Which provides high level of security to the 
system.</p>
<p>This section is to explain how to configure custom script based 
authentication in Gluu. Twilio SMS is used as an example.</p>
<h2 id="twilio-sms-authentication-otp-using-custom-script">Twilio SMS Authentication - OTP using custom script<a class="headerlink" href="#twilio-sms-authentication-otp-using-custom-script" title="Permanent link">#</a></h2>
<h3 id="writing-a-custom-authentication-script">Writing a Custom Authentication Script<a class="headerlink" href="#writing-a-custom-authentication-script" title="Permanent link">#</a></h3>
<p>In this document we walk through the steps of writing a script to i
mplement OTP authentication using <a href="http://twilio.com">Twilio</a> to send 
an SMS code for a two-step out-of-band authentication mechanism.</p>
<p>At the end of this tutorial you should have a better understanding of 
how to write your own custom scripts. For reference, 
you can review the completed Twilio custom authentication script 
<a href="../twilio2FA.py">here</a>. </p>
<p>Fields in Custom Script:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Name</td>
<td align="left">Name of the Script</td>
</tr>
<tr>
<td>Description</td>
<td align="left">[optional] Description about the script</td>
</tr>
<tr>
<td>Programming Language</td>
<td align="left">Currently Python is supported, In future jscript and Java script might be added</td>
</tr>
<tr>
<td>Level</td>
<td align="left">Authentication Level for the authentication, which determines the security level</td>
</tr>
<tr>
<td>Location Type</td>
<td align="left">Determines the script location. Can be stored in a "File" or could be stored in "LDAP"</td>
</tr>
<tr>
<td>Usage Type</td>
<td align="left">Determines the type of the usage. Web, Native or Both</td>
</tr>
<tr>
<td>Custome Property</td>
<td align="left">Determines the key and value of the custom property, which can added to the authentication to pass the values</td>
</tr>
<tr>
<td>Script Box</td>
<td align="left">Script Box will displayed if Location Type is selected as "File", to enter the path of the script</td>
</tr>
<tr>
<td>Script</td>
<td align="left">Script Box will be displayed when Location Type is selected as "LDAP"</td>
</tr>
</tbody>
</table>
<h2 id="custom-script-location">Custom Script Location<a class="headerlink" href="#custom-script-location" title="Permanent link">#</a></h2>
<p>Custom scripts can either be inserted directly into the Gluu Server 
interface or you can specify a path to the script. Specifying a path will 
make script development easier. There is also an option to revert back to 
a working script if the script is faulty or needs further enhancements. 
The administrator can select <code>File</code> from the Script Location Type in 
oxTrust and the file input box will be displayed:</p>
<p><img alt="image" src="../../img/admin-guide/multi-factor/script_upload_box.png" /></p>
<p>The 'LDAP' option in the Script Location Type can be used to store the 
script in the LDAP tree once the development is complete. Remember that 
selecting the <code>LDAP</code> method requires the script to be copied in the input 
box that appears upon LDAP selection:</p>
<p><img alt="image" src="../../img/admin-guide/multi-factor/script_in_ldap.png" /></p>
<h4 id="suggested-development-environment">Suggested Development Environment<a class="headerlink" href="#suggested-development-environment" title="Permanent link">#</a></h4>
<p>Gluu Server custom scripts are written in <a href="http://www.jython.org/">Jython</a>. 
It is recommended to use Eclipse for coding purposes.</p>
<p>Now, create some files:
- A Python file for your script
- One or more XHTML files if you have a custom form for your authentication
- One or more XML files (you'll need one for each XHTML file) that provide 
some information to the Tomcat server about how to display the XHTML file.</p>
<h2 id="samples-and-documentation">Samples and Documentation<a class="headerlink" href="#samples-and-documentation" title="Permanent link">#</a></h2>
<p>There are many good examples of authentication interception scripts checked into Gluu's<br />
<a href="https://github.com/GluuFederation/oxAuth/tree/master/Server/integrations">oxAuth integrations folder</a>. 
Also, the respective <code>XHTML</code> and <code>XML</code> files are checked in to the <a href="https://github.com/GluuFederation/oxAuth/tree/master/Server/src/main/webapp/auth">auth folder</a>.
The interfaces for the authentication interception can be found in the <a href="http://www.gluu.org/docs/reference/interception-scripts/#authentication">Gluu Documentation</a>.</p>
<p>We used the <a href="https://raw.githubusercontent.com/GluuFederation/oxAuth/master/Server/integrations/basic/BasicExternalAuthenticator.py">Basic Script</a> 
as a template. The <a href="https://github.com/GluuFederation/oxAuth/tree/master/Server/src/main/webapp/auth/wikid">Wikid forms</a> 
were also used as a template since it is required to pass the value of the "code" 
obtained from Twilio to step 2 of the authentication in order to validate and authenticate the user.</p>
<p>The <a href="https://github.com/GluuFederation/oxAuth/blob/master/Server/integrations/wikid/WikidExternalAuthenticator.py">Wikid authentication</a> script was also looked upon quite a bit for examples on how to process the form.</p>
<h2 id="implement-methods-using-twilio-sms">Implement methods - Using Twilio SMS<a class="headerlink" href="#implement-methods-using-twilio-sms" title="Permanent link">#</a></h2>
<p>Simple example of how to add a custom template and how to pass values between 
2 steps of authentication and save the value temporarily for authentication of a user. Our Sample 
<a href="../twilio2FA.py">Twilio script</a></p>
<ol>
<li>Login to Gluu UI</li>
<li>Navigate to "Configuration" on the Menu panel to the left</li>
<li>Select Manage Custom Scripts</li>
<li>Scroll to the end of the page and click on "Add custom script configuration"</li>
<li>Enter the Name, Description, Programming Language (Python will be by default, 
may be in future Java or JavaSCript will be added)</li>
<li>Select the Level needed to set the security level to.</li>
<li>Select Location Type from the script to be executed.</li>
<li>Select the Usage Type required for the authentication.</li>
<li>Define Custom property which is provided by Twilio and can be noted down from 
Twilio account page of the signed up user. </li>
<li>Click on Enabled to enable the added custom script.</li>
<li>Scroll down to the end of the update and click on Update button to submit the form. </li>
<li>After the custom script is added, click on Manage Authenticaion on the Menu Panel to left. </li>
<li>Select "Default Authentication Method" tab and change the oxTrust authentication mode 
to "Twilio" or "Name of the script" from the drop down.</li>
</ol>
<p><strong>Note: All three below custom properties are mandatory for the Twilio Two-Factor Authentication script to work</strong></p>
<ul>
<li>ACCOUNT_SID - Numerical sequence of numbers, to identify the token assigned to the user associated with Twilio.</li>
<li>AUTH TOKEN  - Alphanumerical number provided by Twilio for the account holder to identify the user.</li>
<li>FROM_NUMBER - Number which is either assigned by Twilio or can be a number user provides to send the code from.</li>
</ul>
<p>As shown in the below illustration:</p>
<p><img alt="image" src="../../img/admin-guide/multi-factor/twilio.png" /></p>
<h2 id="methods">Methods<a class="headerlink" href="#methods" title="Permanent link">#</a></h2>
<p><strong>authenticate():</strong></p>
<p>The most important method to implement is obviously the <code>authenticate</code> method. This is where the main business logic is located for
the authentication workflow. It is possible to switch on the step, with the <code>if (step == 1):</code> statement. In oxAuth, there is no
assumption that step 1 and step 2 happen on the same server, therefore the value stored in the LDAP using a temporarily created attribute and retrieved in step 2. There the step is sent into the <code>authenticate</code> method, which helps to save and retrieve the values whereever required.</p>
<p>Below are few Methods and Libraries used to Save the Value to LDAP and retrieve the values as per the requirement.</p>
<p><strong>random.randit()</strong> 
random.randit("start number",""end number"), Generates the code as per designer or requirements. 
Example: random.randit(10000,99999)</p>
<p><strong>context.set()</strong>
This particular method is obtained from jboss to pass the session attribute value to ldap, by creating a temporary attribute which has limited life time and can be retrieved within the life span, expires and session becomes invalid. Save the value of the code obtained through the code generator method. context.set("Name of the temp attribute", <code>&lt;key&gt;</code>). Where <code>&lt;key&gt;</code> is the value that needs to be stored temporarily in ldap.
Example:
context.set("code",code)</p>
<p><strong>UserService.instance()</strong> 
Gets the user login instance</p>
<p><strong>ServerUtil.getFirstValue():</strong></p>
<p>To access  information from requestParameters in your script with <code>ServerUtil.getFirstValue(requestParameters, &lt;key&gt;)</code> where <code>&lt;key&gt;</code>
specifies the value you want to retrieve, you can also use another method <code>requestParameters.get("&lt;key&gt;")</code>
where <code>&lt;key&gt;</code> specifies the value you want to retrieve .</p>
<p><strong>userService.getUserByAttribute():</strong></p>
<p><code>getUserByAttribute("LDAP Attribute", &lt;key&gt;)</code> method access the information in LDAP and retrieves the value of the attribute comparing the value of the <code>&lt;Key&gt;</code>.
Example:
userService.getUserByAttribute("uid", user_name)</p>
<p><strong>getAttribute():</strong>
To retrieve the value of an attribute from LDAP, getAttribute("LDAP Attribute name") can be used. 
Example:
getAttribute("mobile")</p>
<p><strong>requestParameters.get():</strong>
To retrieve values passed from the form through header can be obtained by using the method requestParameters.get(<code>&lt;key&gt;</code>). This will retrieve the values from the form via header and can be stored in a string. Where <code>&lt;key&gt;</code> is the value to be retrieved from header.
Example:
abc = requestParameters.get("passcode")[0].strip()</p>
<p><strong>getCountAuthenticationSteps():</strong></p>
<p>Another method usually needed to implement is <code>getCountAuthenticationSteps</code>. This method normally just returns 1, 2, or 3. If implementing an adaptive authentication strategy,
where the number of steps depends on the context. Check out the
Duo script for a good example of this. In our sample 
<a href="../DuoExternalAuthenticator.py">Duo script</a>,</p>
<p>Duo Script was scripted only for those who wanted to use Duo
for the IT group. So this was checked for group membership, and dynamically adjusted the number of steps. And this can be scripted for any logic or attribute to the check the authentication, like "country" or "region".</p>
<p><strong>getExtraParametersForStep():</strong></p>
<p>If required to save session variables between steps, use the <code>getExtraParametersForStep</code> method. The Gluu Server persists
these variables in LDAP in able to support stateless clustered two
step authentications.</p>
<p><strong>getPageForStep():</strong></p>
<p>If required to display a special Web page for an interactive
login, (or even a custom first page) you'll need to implement the
<code>getPageForStep</code> which specifies the page you want to return for a given
step.</p>
<p><strong>session_attributes.get():</strong>
The attribute value that are saved by the session using context.set. This method is derived from the oxauth core java libraries and called using the SessionState parameters which is defined in the code or programme.
session_attributes.get(<code>&lt;key&gt;</code>), where <code>&lt;key&gt;</code> is the session atribute value that is stored in the ldap.
Example:
session_attributes.get("code")</p>
<h2 id="saving-the-value-in-ldap-and-passing-values-between-two-steps">Saving the value in LDAP and Passing values between two steps<a class="headerlink" href="#saving-the-value-in-ldap-and-passing-values-between-two-steps" title="Permanent link">#</a></h2>
<h3 id="saving-values">Saving Values:<a class="headerlink" href="#saving-values" title="Permanent link">#</a></h3>
<p><strong>context.set</strong> can be used to save values of the required key to an attribute temporarily and the created temporary attribute will be alive only for limited time and expires and gets removed, by that way, adding new attribute to the user is not messed up. And also the expired attribute kills the validity of the session and becomes invalid.</p>
<h3 id="retriving-and-passing-values-between-the-authentication-steps">Retriving and passing values between the authentication steps:<a class="headerlink" href="#retriving-and-passing-values-between-the-authentication-steps" title="Permanent link">#</a></h3>
<p>Using <strong>session_attribute.get()</strong> method, stored session attribute could be retrieved anywhere between the authentication method, by that way the values can be passed between two authentication methods for verification and validation.
Generated code and the entered "code" in the form can be verified using a simple if and the "code" from the form can be obtained using the requestParameters.get() method or serviceUtil.getFirstValue() method.</p>
<h2 id="custom-properties">Custom Properties<a class="headerlink" href="#custom-properties" title="Permanent link">#</a></h2>
<p>Sometimes it is helpful to enable system administrators to
enter properties that might change a lot. If administrators are
not allowed to modify the script, Custom Property feature can be used, as illustrated in below screenshot:</p>
<p><img alt="image" src="../../img/admin-guide/multi-factor/07-custom-properties.jpg" /></p>
<p>configurationAttributes.get("<key>").getValue2"():</p>
<p>To access this information in your script with 
<code>configurationAttributes.get("&lt;key&gt;").getValue2()</code>
where <code>&lt;key&gt;</code> specifies the value you want to retrieve.</p>
<h2 id="returning-a-message-to-the-user">Returning a message to the user<a class="headerlink" href="#returning-a-message-to-the-user" title="Permanent link">#</a></h2>
<p>It is possible to use the Context to return a message to the
user, which could be especially useful if an error occurs, or if
required to have some kind of user action.</p>
<h2 id="adding-libraries">Adding Libraries<a class="headerlink" href="#adding-libraries" title="Permanent link">#</a></h2>
<p>Pure Python libraries, can be added to <code>/opt/gluu/python/libs</code>, jar files can be added to  <code>/opt/gluu/jetty/oxauth/lib/ext</code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>jar files should be added within chroot. </p>
</div>
<h2 id="testing">Testing<a class="headerlink" href="#testing" title="Permanent link">#</a></h2>
<p>When the scripting is done, you can test the script by print
the statments to oxtrust.log under <code>/opt/gluu/jetty/identity/logs/oxtrust.log</code>. </p>
<p>And by prefix the logs, will help to find the script at ease
using tail command <code>tail -f | grep &lt;prefix&gt;</code>, the prefix logs will
provide the script output while one trys to login using the script.</p>
<p>In the Twilio test script, a specific method called
<code>printOut</code> has been scripted to make it easier to add this prefix.</p>
<p>Also, remember that putting all the code in a <code>try / catch</code>
is a good practice to avoid unhandled exceptions. Since during
debugging, those exception may provide a hint pointing what causes the issue.</p>
<p>Further logs to debug and monitor the sequence can be done using oxauth_script.log and oxauth.log
under<code>/opt/gluu/jetty/identity/logs/</code> which is within the chroot.</p>
<h2 id="reverting-authentication-method">Reverting Authentication Method<a class="headerlink" href="#reverting-authentication-method" title="Permanent link">#</a></h2>
<p>It is not unlikely that one may get locked out of Gluu
Server, while testing the authentication script.</p>
<p>If there is any problem in it. In such a case the following
method can be used to revert back the older authentication method. </p>
<p>As a secondary option, InPrivate or Incognito or Private Browser from various Browsers can be used.</p>
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../otp/" title="HOTP/TOTP" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                HOTP/TOTP
              </span>
            </div>
          </a>
        
        
          <a href="../../admin-guide/saml/" title="SAML" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                SAML
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2016, Gluu, Inc.
          </div>
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application-2afe21e0b2.js"></script>
      <script>var config={url:{base:"../.."}},app=new Application(config);app.initialize()</script>
      
    
    
      
    
  </body>
</html>