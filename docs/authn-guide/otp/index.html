<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="no-js ie6"><![endif]-->
<!--[if IE 7 ]><html class="no-js ie7"><![endif]-->
<!--[if IE 8 ]><html class="no-js ie8"><![endif]-->
<!--[if IE 9 ]><html class="no-js ie9"><![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    
      
        <title>HOTP/TOTP - Gluu Docs</title>
      
<link href="../../assets/stylesheets/font.css" rel="stylesheet">
      
      
      
    
    <meta property="og:url" content="None">
    <meta property="og:title" content="Gluu Docs">
    <meta property="og:image" content="None/../../gluu.jpg">
    <meta name="apple-mobile-web-app-title" content="Gluu Docs">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
      <link rel="apple-touch-icon" href="../../gluu.jpg">
    
    
    <link rel="shortcut icon" type="image/x-icon" href="../../assets/images/favicon-gluu.ico">
    <link rel="icon" type="image/x-icon" href="../../assets/images/favicon-gluu.ico">
    <style>
      @font-face {
      	font-family: 'Icon';
      	src: url('../../assets/fonts/icon.eot?52m981');
      	src: url('../../assets/fonts/icon.eot?#iefix52m981')
               format('embedded-opentype'),
      		   url('../../assets/fonts/icon.woff?52m981')
               format('woff'),
      		   url('../../assets/fonts/icon.ttf?52m981')
               format('truetype'),
      		   url('../../assets/fonts/icon.svg?52m981#icon')
               format('svg');
      	font-weight: normal;
      	font-style: normal;
      }
    </style>
    <link rel="stylesheet" href="../../assets/stylesheets/application-f58e216493.css">
    
    <link rel="stylesheet" href="../../assets/stylesheets/zenburn-28d5b94970.css">
    
      
      
      
      <link rel="stylesheet" href="https://fonts.lug.ustc.edu.cn/css?family=Noto Sans:400,700|Source+Code+Pro">
      <style>
        body, input {
          font-family: 'Noto Sans', Helvetica, Arial, sans-serif;
        }
        pre, code {
          font-family: 'Source Code Pro', 'Courier New', 'Courier', monospace;
        }
      </style>
    
    
    <script src="../../assets/javascripts/modernizr-4a5cc7e01e.js"></script>
    
  </head>
  
  
  
  <body class=" ">
    
    <div class="backdrop">
      <div class="backdrop-paper"></div>
    </div>
    <input class="toggle" type="checkbox" id="toggle-drawer">
    <input class="toggle" type="checkbox" id="toggle-search">
    <label class="toggle-button overlay" for="toggle-drawer"></label>
    <header class="header">
      <nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        
          <span class="path">
            
              
                Administration Guide <i class="icon icon-link"></i>
              
            
              
                User Authentication Guide <i class="icon icon-link"></i>
              
            
          </span>
        
        HOTP/TOTP
      </div>
    </div>
    <div class="button button-search" role="button" aria-label="Search">
      <label class="toggle-button icon icon-search" title="Search" for="toggle-search"></label>
    </div>
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" placeholder="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false">
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
    </header>
    <main class="main">
      
      <div class="drawer">
        <nav aria-label="Navigation">

  
  <a href="https://github.com/GluuFederation/docs-3" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="../../gluu.jpg">
        </div>
      
      <div class="name">
        <strong>Gluu Docs</strong><br>
        version: 3.0.0
        
      </div>
    </div>
  </a>
  <div class="scrollable">
    <div class="wrapper">
      <ul class="repo">
        
        <li class="home">
          <a href="/" title="Home">
            <div class="home-image">
            <i class="fa fa-home"></i> Doc Home</div>
          </a>
        </li>
        
        
        
        <li class="repo-download">
          
          <a href="https://github.com/GluuFederation/docs-3/archive/3.0.0.zip" target="_blank" title="Download" data-action="download">
            <i class="icon icon-download"></i> Download
          </a>
        </li>
        
		
      </ul>
      <div class="toc">
        <ul>
          
            
  <li>
    <a class="" title="Home" href="../..">
      Home
    </a>
    
  </li>
                  
          
            
  <li>
    <a class="" title="Whats new in 3.0" href="../../operation/intro/">
      Whats new in 3.0
    </a>
    
  </li>
                  
          
            
  <li>
    <span class="section">Installation Guide</span>
    <ul>
      
        
  <li>
    <a class="" title="Preparing VM" href="../../installation-guide/">
      Preparing VM
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="Install Gluu Server" href="../../installation-guide/install/">
      Install Gluu Server
    </a>
    
  </li>
                  
      
        
  <li>
    <span class="section">Upgrade/Patch Guide</span>
    <ul>
      
        
  <li>
    <a class="" title="Updating oxTrust" href="../../upgrade/update-oxtrustwar/">
      Updating oxTrust
    </a>
    
  </li>
                  
      
    </ul>
  </li>
                  
      
    </ul>
  </li>
                  
          
            
  <li>
    <span class="section">Administration Guide</span>
    <ul>
      
        
  <li>
    <a class="" title="oxTrust admin UI" href="../../admin-guide/oxtrust-ui/">
      oxTrust admin UI
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="Authentication Management" href="../../admin-guide/auth-management/">
      Authentication Management
    </a>
    
  </li>
                  
      
        
  <li>
    <span class="section">User Authentication Guide</span>
    <ul>
      
        
  <li>
    <a class="" title="User Authentication Introduction" href="../../admin-guide/user-authentications/">
      User Authentication Introduction
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="U2f" href="../U2F/">
      U2f
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="DUO" href="../DUO/">
      DUO
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="oxPush2-Super Gluu" href="../supergluu/">
      oxPush2-Super Gluu
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="certificate Authentication" href="../cert-auth/">
      certificate Authentication
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="Google" href="../google/">
      Google
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="Custom Script Authentication" href="../customauthn/">
      Custom Script Authentication
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="Passport" href="../passport/">
      Passport
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="current" title="HOTP/TOTP" href="./">
      HOTP/TOTP
    </a>
    
      
        
      
      
        <ul>
          
            <li class="anchor">
              <a title="Sequence Diagram" href="#sequence-diagram">
                <b>Sequence Diagram</b>
              </a>
            </li>
            
              <li class="anchor">
              <a title="TOTP/HOTP enrollment/authentication workflow" href="#totphotp-enrollmentauthentication-workflow">
                  <font size=2><i>TOTP/HOTP enrollment/authentication workflow</i></font>
              </a>
            </li>
             
          
            <li class="anchor">
              <a title="Properties" href="#properties">
                <b>Properties</b>
              </a>
            </li>
            
          
            <li class="anchor">
              <a title="Configure OTP with Gluu Server" href="#configure-otp-with-gluu-server">
                <b>Configure OTP with Gluu Server</b>
              </a>
            </li>
            
          
        </ul>
      
    
  </li>
                  
      
    </ul>
  </li>
                  
      
        
  <li>
    <a class="" title="User Management" href="../../admin-guide/user-group/">
      User Management
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="Log Management" href="../../admin-guide/logs/">
      Log Management
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="OpenID Clients" href="../../admin-guide/clients/">
      OpenID Clients
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="SAML SSO" href="../../admin-guide/saml/">
      SAML SSO
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="OpenID Connect" href="../../admin-guide/openid-connect/">
      OpenID Connect
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="UMA" href="../../admin-guide/uma/">
      UMA
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="Attribute Management" href="../../admin-guide/attribute/">
      Attribute Management
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="SCIM protected by UMA" href="../../admin-guide/scim-uma/">
      SCIM protected by UMA
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="Certificate Management" href="../../admin-guide/certificate/">
      Certificate Management
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="FAQ & Troubleshooting" href="../../admin-guide/faq/">
      FAQ & Troubleshooting
    </a>
    
  </li>
                  
      
    </ul>
  </li>
                  
          
            
  <li>
    <span class="section">Reference</span>
    <ul>
      
        
  <li>
    <a class="" title="Gluu Server APIs" href="../../admin-guide/api/">
      Gluu Server APIs
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="Backup Gluu Server CE" href="../../admin-guide/backup/">
      Backup Gluu Server CE
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="Custom Script in Gluu CE" href="../../admin-guide/custom-script/">
      Custom Script in Gluu CE
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="SCIM API Configuration" href="../../admin-guide/scim/">
      SCIM API Configuration
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="Setup Script Options" href="../../installation-guide/setup_py/">
      Setup Script Options
    </a>
    
  </li>
                  
      
    </ul>
  </li>
                  
          
        </ul>
        
      </div>
    </div>
  </div>
</nav>
      </div>
      <article class="article">
        <div class="wrapper">
          
          <h1 id="otp-gluu-authenticator">OTP Gluu Authenticator<a class="headerlink" href="#otp-gluu-authenticator" title="Permanent link">#</a></h1>
<p>OTP authenticator provides 2 factor event/counter-based HOTP algorithm <a href="https://tools.ietf.org/html/rfc4226">RFC4226</a> and the time-based TOTP algorithm <a href="https://tools.ietf.org/html/rfc6238">RFC6238</a> authentications.</p>
<p>In order to use this authenticator user should install mobile authenticator which support HOTP/TOTP.
For example: <a href="https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2">Google authenticator 2</a>. It provides all functionality for both authentication methods. </p>
<p>This is a person authentication module for oxAuth that enables one-time password for user authentication.</p>
<h2 id="sequence-diagram">Sequence Diagram<a class="headerlink" href="#sequence-diagram" title="Permanent link">#</a></h2>
<p>Below is the sequence diagram for TOTP/HOTP and its flow explained:</p>
<p><img alt="sequence diagram" src="../../img/user-authn/otp/gluu_otp_integration_authentication_workflow.png" /></p>
<h3 id="totphotp-enrollmentauthentication-workflow">TOTP/HOTP enrollment/authentication workflow<a class="headerlink" href="#totphotp-enrollmentauthentication-workflow" title="Permanent link">#</a></h3>
<pre><code>Person-&gt;Browser: Open RP URL

Browser-&gt;RP: Protected resource

RP-&gt;Gluu Server: Start AuthZ &amp; AuthN

OTP Script-&gt;OTP Script: Verify user/password

alt: User enrollment
    OTP Script-&gt;OTP Script: Check if person not issued OTP key already
    OTP Script-&gt;Browser: Render otpauth QR code with OTP key 
    Person-&gt;OTP comp. auth.: Scan QR code
    OTP comp. auth.-&gt;Person: New one time passowrd
    Person-&gt;Browser: Enter one time password
    Browser-&gt;OTP Script:
    OTP Script-&gt;OTP Script: Validate one time passowrd
    OTP Script-&gt;OTP Script: Strore OTP key in user entry
    OTP Script-&gt;Gluu Server: User pass enrollment
else User authentication
    OTP Script-&gt;OTP Script: Check if person issued OTP key already
    OTP comp. auth.-&gt;Person: New one time passowrd
    Person-&gt;Browser: Enter one time password
    Browser-&gt;OTP Script:
    OTP Script-&gt;OTP Script: Validate one time passowrd
    OTP Script-&gt;Gluu Server: User pass enrollment
end

Gluu Server-&gt;Browser: Return code
Browser-&gt;RP: Return code

RP-&gt;Gluu Server: Request tokens
RP-&gt;Gluu Server: Request user_info
</code></pre>

<h2 id="properties">Properties<a class="headerlink" href="#properties" title="Permanent link">#</a></h2>
<p>The module has a few properties:</p>
<p>1) otp_type - It's mandatory property. It's specify OTP mode: HOTP/ TOTP.
   Allowed values: hotp/totp
   Example: hotp</p>
<p>2) issuer - It's mandatory property. It's company name.
   Example: Gluu Inc</p>
<p>3) otp_conf_file - It's mandatory property. It's specify path to OTP configuration JSON file.
   Example: /etc/certs/otp_configuration.json</p>
<p>4) label - It's label inside QR code. It's optional property.
    Example: Gluu OTP</p>
<p>5) qr_options - Specify width and height of QR image. It's optional property.
    Example: qr_options: { width: 400, height: 400 }</p>
<p>6) registration_uri - It's URL to page where user can register new account. It's optional property.
    Example: https://hostname/identity/register</p>
<h2 id="configure-otp-with-gluu-server">Configure OTP with Gluu Server<a class="headerlink" href="#configure-otp-with-gluu-server" title="Permanent link">#</a></h2>
<p>This list of steps needed to  enable OTP person authentication module.</p>
<ol>
<li>Confire new custom module in oxTrust:<ul>
<li>Log into oxTrust with administrative permissions.</li>
<li>Open "Configuration→Manage Custom Scripts" page.</li>
<li>Select "Person Authentication" tab.</li>
<li>Click on "Add custom script configuration" link.</li>
<li>Enter name = otp</li>
<li>Enter level = 0-100 (priority of this method).</li>
<li>Select usage type "Interactive".</li>
<li>Add custom required and optional properties which specified in "Properties description.md".</li>
<li>Copy/paste script from TotpExternalAuthenticator.py.</li>
<li>Activate it via "Enabled" checkbox.</li>
<li>Click "Update" button at the bottom of this page.</li>
</ul>
</li>
</ol>
<p><img alt="customscripts" src="../../img/user-authn/otp/custom-scripts.png" />
<img alt="select-otp" src="../../img/user-authn/otp/selct-otp.png" />
<img alt="update" src="../../img/user-authn/otp/update.png" /></p>
<ol>
<li>Configure oxAuth to use OTP authentication by default:<ul>
<li>Log into oxTrust with administrative permissions.</li>
<li>Open "Configuration→Manage Authentication" page.</li>
<li>Scroll to "Default Authentication Method" panel. Select "otp" authentication mode.</li>
<li>Click "Update" button at the bottom of this page.</li>
</ul>
</li>
</ol>
<p><img alt="defaulttab" src="../../img/user-authn/otp/default-authtab.png" /></p>
<ol>
<li>Try to log in using OTP authentication method:<ul>
<li>Wait 30 seconds and try to log in again. During this time oxAuth reload list of available person authentication modules.</li>
<li>Once the scanning of QR is done on your mobile, click on Finish to get the OTP page to enter otp from your mobile.</li>
<li>Open second browser or second browsing session and try to log in again. It's better to try to do that from another browser session because we can return back to previous authentication method if something will go wrong.</li>
</ul>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Even if you have OTP generated on the mobile authenticator app, you might have to scan the qr code again, if you are logging in from different computer or at a different time or for a different session. Since the QR code would expire after some time.</p>
</div>
<p><img alt="login" src="../../img/user-authn/otp/login-page.png" />
<img alt="scanqr" src="../../img/user-authn/otp/scan-qr.png" /></p>
<p>There are log messages in this custom authentication script. In order to debug this module we can use below command.</p>
<pre><code>tail -f /opt/gluu/jetty/identity/logs/oxtrust.log | grep &quot;OTP&quot;
</code></pre>

<p>and</p>
<pre><code>tail -f /opt/gluu/jetty/identity/logs/oxtrust_script.log | grep &quot;OTP&quot;
</code></pre>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Logs would be populate only if logs are enabled. For more on logs refer <a href="../../admin-guide/logs/">Log management</a></p>
</div>
          <aside class="copyright" role="note">
           Built with 
            <a href="http://www.mkdocs.org" target="_blank">MkDocs</a> using
            <a href="http://gitlab.testbird.io:8099/frontend/testbird-mkdocs-theme.git" target="_blank">
              testBird-mkdocs-theme
            </a> <br>
            
            Copyright &copy; 2016, Gluu, Inc.
            
          </aside>
          
            <footer class="footer">
              
  <nav class="pagination" aria-label="Footer">
    <div class="previous">
      
        <a href="../passport/" title="Passport">
          <span class="direction">
            Previous
          </span>
          <div class="page">
            <div class="button button-previous" role="button" aria-label="Previous">
              <i class="icon icon-back"></i>
            </div>
            <div class="stretch">
              <div class="title">
                Passport
              </div>
            </div>
          </div>
        </a>
      
    </div>
    <div class="next">
      
        <a href="../../admin-guide/user-group/" title="User Management">
          <span class="direction">
            Next
          </span>
          <div class="page">
            <div class="stretch">
              <div class="title">
                User Management
              </div>
            </div>
            <div class="button button-next" role="button" aria-label="Next">
              <i class="icon icon-forward"></i>
            </div>
          </div>
        </a>
      
    </div>
  </nav>

            </footer>
          
        </div>
      </article>
      <div class="results" role="status" aria-live="polite">
        <div class="scrollable">
          <div class="wrapper">
            <div class="meta"></div>
            <div class="list"></div>
          </div>
        </div>
      </div>
    </main>
    <script>
      var base_url = '../..';
      var repo_id  = '';
    </script>
    <script src="../../assets/javascripts/application-ce3999cf34.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    
    
  </body>
</html>