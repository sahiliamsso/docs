
<!DOCTYPE html>
<html class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documenation for Gluu Server">
      
      
      
      
        <link rel="shortcut icon" href="../../favicon.ico">
      
      <meta name="generator" content="mkdocs+mkdocs-material#1.0.3">
    
    
      
        <title>Passport - Gluu Docs</title>
      
    
    
      <script src="../../assets/javascripts/modernizr-facb31f4a3.js"></script>
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application-f3ab63f78a.css">
      
      
    
    
  </head>
  
  
  
  
    <body>
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Gluu Docs" class=" md-logo  md-header-nav__button">
          
            <img src="../../gluu.jpg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Administration Guide
                </span>
              
                <span class="md-header-nav__parent">
                  User Authentication Guide
                </span>
              
            
            Passport
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <div class="md-search__overlay"></div>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false">
      <label class="md-icon md-search__icon" for="search"></label>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result"></div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            
              


  


  <a href="https://github.com/GluuFederation/docs-3" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

            
          </div>
      </div>
    </div>
  </nav>
</header>
    
    <div class="md-container">
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <i class=" md-logo  md-nav__button">
      
        <img src="../../gluu.jpg">
      
    </i>
    Gluu Docs
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/GluuFederation/docs-3" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  <li class="md-nav__item">
    
      <a href="../.." title="Home" class="md-nav__link">
        Home
      </a>
    
  </li>

    
      
      
  <li class="md-nav__item">
    
      <a href="../../operation/intro/" title="Whats new in 3.0" class="md-nav__link">
        Whats new in 3.0
      </a>
    
  </li>

    
      
      
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Installation Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-3">
        Installation Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../../installation-guide/" title="Preparing VM" class="md-nav__link">
        Preparing VM
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../installation-guide/install/" title="Install Gluu Server" class="md-nav__link">
        Install Gluu Server
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../installation-guide/setup_py/" title="Setup Script Options" class="md-nav__link">
        Setup Script Options
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-4" type="checkbox" id="nav-3-4">
    
    <label class="md-nav__link" for="nav-3-4">
      Upgrade/Patch Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-3-4">
        Upgrade/Patch Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../../upgrade/" title="Upgrade Gluu Server" class="md-nav__link">
        Upgrade Gluu Server
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../upgrade/update-war/" title="Updating a War File" class="md-nav__link">
        Updating a War File
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Administration Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-4">
        Administration Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../../admin-guide/oxtrust-ui/" title="oxTrust admin UI" class="md-nav__link">
        oxTrust admin UI
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../admin-guide/session/" title="Session Timeout" class="md-nav__link">
        Session Timeout
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../admin-guide/auth-management/" title="Authentication Management" class="md-nav__link">
        Authentication Management
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../admin-guide/custom-script/" title="Custom Script in Gluu CE" class="md-nav__link">
        Custom Script in Gluu CE
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-5" type="checkbox" id="nav-4-5" checked>
    
    <label class="md-nav__link" for="nav-4-5">
      User Authentication Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-4-5">
        User Authentication Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../../admin-guide/user-authentications/" title="User Authentication Introduction" class="md-nav__link">
        User Authentication Introduction
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../U2F/" title="U2f" class="md-nav__link">
        U2f
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../DUO/" title="DUO" class="md-nav__link">
        DUO
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../supergluu/" title="oxPush2-Super Gluu" class="md-nav__link">
        oxPush2-Super Gluu
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../cert-auth/" title="certificate Authentication" class="md-nav__link">
        certificate Authentication
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../google/" title="Google" class="md-nav__link">
        Google
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../customauthn/" title="Custom Script Authentication" class="md-nav__link">
        Custom Script Authentication
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Passport
      </label>
    
    <a href="./" title="Passport" class="md-nav__link md-nav__link--active">
      Passport
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" title="Overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-passportjs-with-gluu" title="SETUP Passport.js with Gluu" class="md-nav__link">
    SETUP Passport.js with Gluu
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-create-a-new-app-to-use-for-passport-server" title="How to create a new app to use for Passport server?" class="md-nav__link">
    How to create a new app to use for Passport server?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-add-new-strategies-to-passport-server" title="How to add new strategies to Passport server?" class="md-nav__link">
    How to add new strategies to Passport server?
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configure-the-strategy" title="Configure the strategy" class="md-nav__link">
    Configure the strategy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-routes-for-the-strategy" title="Configure routes for the strategy" class="md-nav__link">
    Configure routes for the strategy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#call-method-to-configure-the-strategy" title="Call method to configure the strategy" class="md-nav__link">
    Call method to configure the strategy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-button-for-the-configured-strategy-in-passport-authentication-ui" title="Add button for the configured strategy in passport authentication UI." class="md-nav__link">
    Add button for the configured strategy in passport authentication UI.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../otp/" title="HOTP/TOTP" class="md-nav__link">
        HOTP/TOTP
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../admin-guide/user-group/" title="User Management" class="md-nav__link">
        User Management
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../admin-guide/logs/" title="Log Management" class="md-nav__link">
        Log Management
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../admin-guide/saml/" title="SAML" class="md-nav__link">
        SAML
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../admin-guide/openid-connect/" title="OpenID Connect" class="md-nav__link">
        OpenID Connect
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../admin-guide/clients/" title="OpenID Connect Clients" class="md-nav__link">
        OpenID Connect Clients
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../admin-guide/uma/" title="UMA" class="md-nav__link">
        UMA
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../admin-guide/attribute/" title="Attribute Management" class="md-nav__link">
        Attribute Management
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../admin-guide/scim-uma/" title="SCIM protected by UMA" class="md-nav__link">
        SCIM protected by UMA
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../admin-guide/certificate/" title="Certificate Management" class="md-nav__link">
        Certificate Management
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../admin-guide/faq/" title="FAQ & Troubleshooting" class="md-nav__link">
        FAQ & Troubleshooting
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Integration Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-5">
        Integration Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/saml-sp/" title="Shibboleth SP" class="md-nav__link">
        Shibboleth SP
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/openidc-rp/" title="Mod_auth_OpenID" class="md-nav__link">
        Mod_auth_OpenID
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/oauth2/" title="OXD OAuth2" class="md-nav__link">
        OXD OAuth2
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/google/" title="Google SSO" class="md-nav__link">
        Google SSO
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/office/" title="Office 365" class="md-nav__link">
        Office 365
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/salesforce/" title="Salesforce" class="md-nav__link">
        Salesforce
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/dropbox/" title="Dropbox" class="md-nav__link">
        Dropbox
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Reference
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-6">
        Reference
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-1" type="checkbox" id="nav-6-1">
    
    <label class="md-nav__link" for="nav-6-1">
      Gluu API Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-6-1">
        Gluu API Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../../api-guide/api/" title="Custom ID Generation" class="md-nav__link">
        Custom ID Generation
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../api-guide/openid-connect-api/" title="OpenID Connect API" class="md-nav__link">
        OpenID Connect API
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../api-guide/scim-api/" title="SCIM API Configuration" class="md-nav__link">
        SCIM API Configuration
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../api-guide/uma-api/" title="UMA API" class="md-nav__link">
        UMA API
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-2" type="checkbox" id="nav-6-2">
    
    <label class="md-nav__link" for="nav-6-2">
      JSON Properties
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-6-2">
        JSON Properties
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../../reference/JSON-oxtrust-prop/" title="OxTrust JSON Properties" class="md-nav__link">
        OxTrust JSON Properties
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../reference/JSON-oxauth-prop/" title="OxAuth JSON Properties" class="md-nav__link">
        OxAuth JSON Properties
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Operation Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-7">
        Operation Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../../operation/backup/" title="Backup Gluu Server CE" class="md-nav__link">
        Backup Gluu Server CE
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../operation/find-gluu-version/" title="Know your Gluu Version" class="md-nav__link">
        Know your Gluu Version
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../operation/ports/" title="Ports used in Gluu" class="md-nav__link">
        Ports used in Gluu
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../operation/logout/" title="Logout from Gluu Server" class="md-nav__link">
        Logout from Gluu Server
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" title="Overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-passportjs-with-gluu" title="SETUP Passport.js with Gluu" class="md-nav__link">
    SETUP Passport.js with Gluu
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-create-a-new-app-to-use-for-passport-server" title="How to create a new app to use for Passport server?" class="md-nav__link">
    How to create a new app to use for Passport server?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-add-new-strategies-to-passport-server" title="How to add new strategies to Passport server?" class="md-nav__link">
    How to add new strategies to Passport server?
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configure-the-strategy" title="Configure the strategy" class="md-nav__link">
    Configure the strategy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-routes-for-the-strategy" title="Configure routes for the strategy" class="md-nav__link">
    Configure routes for the strategy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#call-method-to-configure-the-strategy" title="Call method to configure the strategy" class="md-nav__link">
    Call method to configure the strategy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-button-for-the-configured-strategy-in-passport-authentication-ui" title="Add button for the configured strategy in passport authentication UI." class="md-nav__link">
    Add button for the configured strategy in passport authentication UI.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
               
                 <a href="https://github.com/GluuFederation/docs-3/blob/master/source/authn-guide\passport.md" title="Edit this page" class="md-icon md-content__edit">edit</a>
               
              
                
                <h1 id="passportjs-authentication">Passport.js Authentication<a class="headerlink" href="#passportjs-authentication" title="Permanent link">#</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">#</a></h2>
<p><a href="http://passportjs.org/">Passport</a> is a component used in the Gluu
Server to consolidate social login. With over 300 existing
"strategies" it provides a crowd-sourced approach to supporting
popular existing websites. Passport not only normalizes authentication, 
it also provides a standard mapping for user claims. </p>
<p>Passport is an Express-based web application. We've modified it 
to call oxTrust API's for it's non-static configuration. Because its 
configuration is stored centrally in LDAP, you can scale Passport even 
in clustered topologies.</p>
<p>The Gluu Server needs only one interception script for Passport. This 
script is distributed in our default distribution. Post-authentication,
this script uses just-in-time provisioning to add the user to the Gluu
LDAP server if a local account does not already exist. In this way, 
the Gluu SAML and OpenID Connect providers can gather claims and maintain
SSO as normal.</p>
<p>Below is a sequence diagram to help clarify the workflow for user
authentication and provisioning. </p>
<p><img alt="Sequence Diagram" src="../../img/user-authn/passport/sequence_diagram.png" title="Title" /></p>
<ol>
<li>Gluu server calls Node-Passport server for JWT token.</li>
<li>Node-Passport server generates a JWT token and provides it in response to Gluu server.</li>
<li>Gluu server requests Node-Passport server with JWT token to authenticate user for a social network provider.</li>
<li>Node-Passport server will redirect user to social media authentication provider.</li>
<li>After successful authentication of user, social network will callback Node-Passport server along with user details and access token.</li>
<li>Node-Passport server will redirect user back to Gluu server with user details and access token.</li>
<li>Gluu serverâ€™s interception script will check if the user exists in LDAP server and if user exists then user will be logged into the system and if not, then it will create new user with the required details and logs user into the system.</li>
</ol>
<h2 id="setup-passportjs-with-gluu">SETUP Passport.js with Gluu<a class="headerlink" href="#setup-passportjs-with-gluu" title="Permanent link">#</a></h2>
<p>During installation of the Gluu Server select <code>yes</code> to install Passport.js when prompted.</p>
<ol>
<li>Click on Manage Custom Scripts under configuration tab on the main menu.</li>
<li>Enable passport script in Person Authentication Tab.<img alt="Enable passport1" src="../../img/user-authn/passport/enable-passport.png" /></li>
<li>Click on update at the end of the page.<img alt="update" src="../../img/user-authn/passport/auth-update.png" /></li>
<li>Enable uma authorization policy in uma authorization policy tab.<img alt="uma-enable" src="../../img/user-authn/passport/uma-enable.png" /></li>
<li>Click on update.</li>
<li>To set the strategies from Configuration &gt; Manage Authentication &gt; Default Authenticaion</li>
<li>Under Default Authenticaion tab, change Authentication mode to passport</li>
<li>Change passport support to enabled.<img alt="enable-authentication" src="../../img/user-authn/passport/enable-authentication.png" /></li>
<li>Once Passport support is enabled and updated, Passport Authentication Method will appear in the next tab.</li>
<li>Click on the Passport Authenticaion Method, and set the strategies as follows,The values for Strategy field for common providers are:<ul>
<li>google for GPlus Authentication</li>
<li>twitter for Twitter Authentication</li>
<li>linkedin for LinkedIn Authentication</li>
<li>github for Github Authentication</li>
<li>facebook for Facebook Authentication</li>
</ul>
</li>
<li>And then add the strategy details like clientID and clientSecret.
            clientID and clientSecret are details obtained from the provider, after the app is created in the provider form.<img alt="setting-strategies" src="../../img/user-authn/passport/setting-strategies.png" /></li>
<li>
<p>Once the configuration and settings are done, restart the passport service or Gluu Server.</p>
<p>a. Login to chroot.</p>
<p>b. Enter below command to stop.</p>
<pre><code>`service passport stop`
</code></pre>
<p>c. Below command to start.</p>
<pre><code>`service passport start`
</code></pre>
</li>
</ol>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Strategies names and field names are case sensitive.</p>
</div>
<h2 id="how-to-create-a-new-app-to-use-for-passport-server">How to create a new app to use for Passport server?<a class="headerlink" href="#how-to-create-a-new-app-to-use-for-passport-server" title="Permanent link">#</a></h2>
<p>Every provider has different protocols and ways to create the app. We 
will look at one of the most common providers "facebook" and create a new app.</p>
<ol>
<li>Login to https://developers.facebook.com</li>
<li>Click on Add a new App from My Apps dropdown</li>
<li>Fill the required details and click the create Create App ID button to create the app.</li>
<li>Click on the dashboard menu and get the clientID and clientSecret which can be used with the passport.</li>
<li>Click on settings menu and put the domain of your gluu server in the App Domains field.</li>
</ol>
<p>Note: If there is a filed for Authorized redirect URIs, make sure the 
Authorized redirect URIs list of your app contains the passport 
strategy's callback. If your gluu server points to 
https://example.gluu.org and the strategy is facebook, the list of 
Authorized redirect URIs should contain 
https://example.gluu.org/passport/auth/facebook/callback.
Make sure the  Authorized redirect URIs list of your app contains the 
passport strategy's callback.
If your gluu server points to https://example.gluu.org and the strategy 
is facebook, the list of Authorized redirect URIs should 
contain https://example.gluu.org/passport/auth/facebook/callback.</p>
<h2 id="how-to-add-new-strategies-to-passport-server">How to add new strategies to Passport server?<a class="headerlink" href="#how-to-add-new-strategies-to-passport-server" title="Permanent link">#</a></h2>
<p>Find an npm module that fits best for the strategy that you want to add.
Let's start with an example. In this example we will consider adding facebook strategy.</p>
<ol>
<li>If you want to add facebook strategy, search for passport-facebook npm module where you can select the npm module and then add the module to passport server.</li>
<li>Let's say we found this module "passport-facebook" and want to use this module in for facebook authentication, install the module in passport app by executing <code>npm install passport-facebook --save</code> to install the module and also save the dependency to the passport server.</li>
<li>Configure the strategy.</li>
<li>Configure routes for the strategy.</li>
<li>Call method to configure the strategy</li>
<li>Add button for the configured strategy in passport authentication UI.</li>
</ol>
<h5 id="configure-the-strategy">Configure the strategy<a class="headerlink" href="#configure-the-strategy" title="Permanent link">#</a></h5>
<p>All the strategies are been configured in the folder server/auth/*.js.
We need to create new file named with the strategy name. Our strategy is facebook so we can create new file named facebook.js and configure the strategy.</p>
<pre><code class="javascript">var passport = require('passport');
var FacebookStrategy = require('passport-facebook').Strategy;

var setCredentials = function(credentials) {
    var callbackURL = global.applicationHost.concat(&quot;/passport/auth/facebook/callback&quot;);
    passport.use(new FacebookStrategy({
            clientID: credentials.clientID,
            clientSecret: credentials.clientSecret,
            callbackURL: callbackURL,
            enableProof: true,
            profileFields: ['id', 'name', 'displayName', 'email']
        },
        function(accessToken, refreshToken, profile, done) {
            var userProfile = {
                id: profile._json.id,
                name: profile.displayName,
                username: profile.username || profile._json.id,
                email: profile._json.email,
                givenName: profile._json.first_name,
                familyName: profile._json.last_name,
                provider: profile.provider,
                accessToken: accessToken
            };
            return done(null, userProfile);
        }
    ));
};

module.exports = {
    passport: passport,
    setCredentials: setCredentials
};
</code></pre>

<p>Here is an example of the facebook strategy configured. For facebook 
the required parameters are clientID, clientSecret and callbackURL. You 
can search for more configurations depending on the requirements and 
configure accordingly.</p>
<p>The function setCredentials is used to configure the strategy of the 
credentials of this strategy are been received. The parameter credentials 
holds the values that are stored in the oxTrust</p>
<p>The parameter callbackURL should point to the callback route that we 
will configure in step 4. As we are configuring facebook strategy, the 
<code>callbackURL</code> can be set to <code>"/passport/auth/facebook/callback"</code> 
according the the convention of the app. You can customise the 
<code>callbackURL</code> but it is recommended not to change the convention.</p>
<p>The callback function has different number of parameters and data in 
those parameters which are required to be mapped to the userProfile 
keys which are <code>id, name, username, email, givenName, familyName, provider, accessToken</code>. 
Here id and provider params are must. Provider param holds the value of 
the provider, i.e for facebook the provider value will be facebook etc. 
In most cases the value of provider is received in the user claims itself.</p>
<p>Then export the strategy that we configured and also the <code>setCredentials</code> 
method which will be used to set the details of the strategy.</p>
<h5 id="configure-routes-for-the-strategy">Configure routes for the strategy<a class="headerlink" href="#configure-routes-for-the-strategy" title="Permanent link">#</a></h5>
<p>We are going to set the routes for the strategy that we are going to configure.
First require the strategy that we configured in the previous step.</p>
<pre><code class="javascript">var passportFacebook = require('../auth/facebook').passport;
</code></pre>

<p>Here <code>require('../auth/facebook').passport</code> will include the passport 
strategy that we have configured.</p>
<p>Then add the routes for the strategy. First we are going to register the 
callback route and then the authenticate route.</p>
<p>The authenticate route first validated the jwt token that is been sent by
Gluu Server to passport server. If the JWT is valid then the user is 
redirected to the strategy and user can be authenticated there and the 
response of the user authentication is redirected to callback route.</p>
<p>If the callback routes receives the user data then user is been 
redirected to Gluu.</p>
<pre><code class="javascript">//==================== facebook ================
router.get('/auth/facebook/callback',
    passportFacebook.authenticate('facebook', {
        failureRedirect: '/passport/login'
    }),
    callbackResponse);

router.get('/auth/facebook/:token',
    validateToken,
    passportFacebook.authenticate('facebook', {
        scope: ['email']
    }));
</code></pre>

<p>scope value can be set from the strategy itself it it supports that 
or you can set the scope value here too.</p>
<p>The callbackResponse method return the control to Gluu server and 
user is been enrolled in the system.</p>
<h5 id="call-method-to-configure-the-strategy">Call method to configure the strategy<a class="headerlink" href="#call-method-to-configure-the-strategy" title="Permanent link">#</a></h5>
<p>In this step we are going to call the setCredentials method of the 
strategy that we have created.</p>
<p>Go to the file configureStrategies.js in auth folder of passport 
server and require the strategy that we have created.</p>
<pre><code class="javascript">var FacebookStrategy = require('./facebook');
</code></pre>

<p>And then in setConfiguratins function, call the setCredentials 
method if the strategy data is received.</p>
<pre><code class="javascript">//FacebookStrategy
if (data.passportStrategies.facebook) {
    logger.log('info', 'Facebook Strategy details received');
    logger.sendMQMessage('info: Facebook Strategy details received');
    FacebookStrategy.setCredentials(data.passportStrategies.facebook);
}
</code></pre>

<p>This will configure the passport strategy if the details of the 
strategy are received from passport API.</p>
<h5 id="add-button-for-the-configured-strategy-in-passport-authentication-ui">Add button for the configured strategy in passport authentication UI.<a class="headerlink" href="#add-button-for-the-configured-strategy-in-passport-authentication-ui" title="Permanent link">#</a></h5>
<p>So far the passport server is ready with the new strategy that we have 
created, but to call the strategy we need to add a button which calls 
the new strategy.</p>
<pre><code class="xhtml">&lt;a data-p=&quot;facebook&quot; class=&quot;provider&quot; href=&quot;javascript:void(0);&quot; style=&quot;height:40px; width:120px&quot;&gt;
    &lt;img alt=&quot;facebook&quot; src=&quot;img/facebook.png&quot; style=&quot;height:40px; width:40px&quot;&gt;&lt;/img&gt;
&lt;/a&gt;
</code></pre>

<p>Here the data-p and class="provider" are required to call the strategy. 
The data-p attribute should hold the value of the route that we created 
in routes.</p>
<pre><code class="javascript">//==================== facebook ================
router.get('/auth/facebook/callback',
    passportFacebook.authenticate('facebook', {
        failureRedirect: '/passport/login'
    }),
    callbackResponse);

router.get('/auth/facebook/:token',
    validateToken,
    passportFacebook.authenticate('facebook', {
        scope: ['email']
    }));
</code></pre>

<p>In order to call the Strategy, the request URL to call the API must 
match the route that we configured.</p>
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../customauthn/" title="Custom Script Authentication" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Custom Script Authentication
              </span>
            </div>
          </a>
        
        
          <a href="../otp/" title="HOTP/TOTP" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                HOTP/TOTP
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2016, Gluu, Inc.
          </div>
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application-2afe21e0b2.js"></script>
      <script>var config={url:{base:"../.."}},app=new Application(config);app.initialize()</script>
      
    
    
      
    
  </body>
</html>